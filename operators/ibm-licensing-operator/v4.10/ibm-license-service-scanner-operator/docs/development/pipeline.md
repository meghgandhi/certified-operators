# Development pipeline

While developing features, bug fixes, or even accounting for typo-s, the code should be checked with the automated tools
as much as possible (that's what the tools are for).

Below is a description of available tools, together with recommendations on when and how to run them. For daily
development (or, e.g. before making a PR), the following should be done:

- `make lint` -> for checking the quality and formatting of the code
- `make generate manifests bundle` -> to update generated files
- `make test` (TODO) -> to check against potential bugs and problems

You can refer to the `.travis.yml` file to see the steps that may need additional testing. Running the code locally
(or against a cluster) can be achieved simply with `make run`.

Naturally, the tools and their configurations are not set in stone, and may evolve in time. When applying changes to the
pipeline, it is crucial to ensure the integration with automation tools does not break (e.g. GitHub Workflows).

## Building and pushing

Building and pushing changes to the codebase can generally be achieved with how `.travis.yml` does it. You can refer to
it or check the [Makefile(s) documentation][makefile-docs] for more information.

The general process is as follows:

- Log into the artifactory
- Build and push the codebase
- Build and push the bundle
- Build and push the catalog
- Update manifest files

The `Dockerfile` is used to build the codebase, while `bundle.Dockerfile` to build the bundle (generated by
`make bundle`).

[makefile-docs]: ./makefile.md

## Linting

To ensure high code quality and address easily-detectable issues, linting should be run before preparing any PR to the
remote repository. Furthermore, the repository itself should run linters, to guard against developers being forgetful.

Run `make lint` to execute all linters. Examine `Makefile` to check which linters are available. For convenience,
here is a short summary:

- `golangci-lint` - From https://github.com/golangci/golangci-lint, inspect `.golangci.yml` for configuration.

In the ideal scenario, nearly all files included in the project should be linted, not just the source code.

## Versioning

Versioning follows [semver][semver].

Current version of the operator is defined in the `version/version.go` file for ease of integration with existing
infrastructure tools. In addition, there are several other places (YAML files) which reference this version by value.

It should not be necessary to adjust the version numbers while developing features. Instead, version numbers should be
changed when preparing a new release (so, a new version of the software). When ready, you must updates all occurrences
of the version number. You can do that with the `update-version` makefile target.

[semver]: https://semver.org/

## Online tools

When running against a cluster with development builds, remember to configure mirroring, so that dev images can be found
and downloaded properly.

The automated pipeline is defined in `.travis.yml`.

Whitesource scans must be addressed for the pipeline to succeed.
